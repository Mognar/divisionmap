<html>
<head>

	<meta name="viewport" content="width=device-width">

	<meta charset="UTF-8">
	
	
	<link rel="stylesheet" media="screen and (max-width: 500px)" href="./narrow.css">
	<link rel="stylesheet" media="screen and (min-width: 501px)" href="./wide.css">
</head>
<body>
<div id="left_column">
<h1 text-align="center">Divisions in the Commons: 2017 Parliament</h1>
  <p text-align="center">Hover mouse over each constituency hexagon to see the name of the constituency, the MP, and the number of divisions voted in. <br/><br/>
	The colours of hexagons correspond to the number of divisions voted in by that MP - the lighter the colour, the more divisions the Member has voted in. <br/><br/>
    There are several hexagons which are black - these are constituencies where the MP has not voted. <br/><br/>
	In many cases, this will be due to the Member holding a role that does not permit them to take part in divisions, e.g, Speaker of the House.<br/><br/>
	There are also Members who do not vote out of choice, for instance the Members of Sinn Fein do not attend the House to vote. <br/><br/>
	</p></div>
<div id="vis"></div>
<script src="https://d3js.org/d3.v4.min.js"></script>
<script src="d3-hexjson.js"></script>
<script>




d3.json("https://raw.githubusercontent.com/Mognar/hexjsonmaybe/master/tst.hexjson", function(error, hexjson) {

	var div = d3.select("body").append("div")	
    	.attr("class", "tooltip")				
    	.style("opacity", 0);

var hexy = hexjson.hexes

var hexarray = []

Object.keys(hexy); // ['foo', 'baz']
Object.keys(hexy).map(function(key){ return hexy[key] }) // ['bar', 'quux']
Object.keys(hexy).forEach(function (key) {
 props = hexy[key].Divs;
	if (props != null){
		props2 = props;
  hexarray.push(props2);
}
//console.log(props2);


//console.log(d3.max(props2));

});

//console.log(hexarray);
hexmax = d3.max(hexarray);




	// Set the size and margins of the svg
	var margin = {top: 10, right: 10, bottom: 10, left: 10},
		width = 600,
		height = 720;

	// Create the svg element
	var svg = d3
		.select("#vis")
		.classed("svg-container", true)
		.append("svg")
		.attr("width", width + margin.left + margin.right)
		.attr("height", height + margin.top + margin.bottom)
 		//.style("width", width1)
  		//.style("height", height1)
		.attr("preserveAspectRatio", "xMinYMin meet")
   		.attr("viewBox", "0 0 600 750")
   		//class to make it responsive
   		.classed("svg-content-responsive", true) 
		.append("g")
		.attr("transform", "translate(" + margin.left + "," + margin.top + ")");
		

	// Render the hexes
	var grid = d3.getGridForHexJSON(hexjson);
	var gridHexes = d3.renderHexJSON(grid, width, height);
	var hexes = d3.renderHexJSON(hexjson, width, height);

	var hexgrid = svg
		.selectAll("g.grid")
		.data(gridHexes)
		.enter()
		.append("g")
		.attr("transform", function(hex) {
			return "translate(" + hex.x + "," + hex.y + ")";
		});

	// Draw the polygons around each grid hex's centre
	hexgrid
		.append("polygon")
		.attr("points", function(hex) {return hex.points;})
		.attr("stroke", "#b0b0b0")
		.attr("stroke-width", "1")
		.attr("fill", "##a7cee2");

	// Bind the hexes to g elements of the svg and position them
	var hexmap = svg
		.selectAll("g.data")
		.data(hexes)
		.enter()
		.append("g")
		.attr("transform", function(hex) {
			return "translate(" + hex.x + "," + hex.y + ")";
		});
		


	//get the range of divisions in the data to create a color scale
	
	
	var color = d3.scaleSequential()
                     .domain([0, hexmax])
                     .interpolator(d3.interpolateCool);

	// Draw the polygons around each hex's centre
	hexmap
		.append("polygon")
		.attr("points", function(hex) {return hex.points;})
		.attr("stroke", "white")
		.attr("stroke-width", "2")
		//.attr("fill", "#b0e8f0");
		.style("fill", function(d) { return color(d.Divs);
			});


	// Add the hex codes as labels
	hexmap
		.append("text")
		.append("tspan")
		.attr("text-anchor", "middle")
		.text(function(hex) {return hex.Divs;});


	hexmap	
		.on("mouseover", function(d) {		
            div.transition()		
                .duration(200)		
                .style("opacity", .9);
		div.html (function(){
			if (d.n == "Buckingham"){
				return "Speaker Bercow does not take part in Divisions";
				}
			else if (d.n == "Newry and Armagh"){
				return "Mickey Brady is a Sinn Fein MP, they do not take part in divisions";
				}
			else if (d.n == "Mid Ulster"){
				return "Francie Molloy is a Sinn Fein MP, they do not take part in divisions";
				}
			else if (d.n == "South Down"){
				return "Chris Hazzard is a Sinn Fein MP, they do not take part in divisions";
				}
			else if (d.n == "Belfast West"){
				return "Paul Maskey is a Sinn Fein MP, they do not take part in divisions";
				}
			else if (d.n == "Fermanagh and South Tyrone"){
				return "Michelle Gildernew is a Sinn Fein MP, they do not take part in divisions";
				}
			else if (d.n == "Foyle"){
				return "Elisha McCallion is a Sinn Fein MP, they do not take part in divisions";
				}
			else if (d.n == "West Tyrone"){
				return "Barry McElduff is a Sinn Fein MP, they do not take part in divisions";
				}
			else if (d.n == "Chorley"){
				return "Lindsay Hoyle is Deputy Speaker, therefore does not take part in divisions";
				}
			else if (d.n == "Doncaster Central"){
				return "Dame Rosie Winterton is Deputy Speaker, therefore does not take part in divisions";
				}
			else if (d.n == "Epping Forest"){
				return "Eleanor Laing is Deputy Speaker, therefore does not take part in divisions";
				}	
			else {	
            			return (d.Divs) + " divisions voted in" + "<br/>"  + d.MP + ", " + d.n + ", " + d.Party;
				}
			})
                .style("left", (d3.event.pageX) + "px")
         	.style("top", (d3.event.pageY) + "px");
            })	
		.on("mouseout", function(d) {
       div.transition()
         .duration(500)
         .style("opacity", 0);
       });				



});

</script>
</body>
</html>
